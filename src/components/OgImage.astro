---
import fs from 'fs/promises';
import path from 'path';
import { OgImageGenerator } from './OgImageGenerator';

interface Props {
  title: string;
  slug: string;
}

const { title, slug } = Astro.props;

async function generateAndSaveImage(title: string, slug: string) {
  const imageResponse = await OgImageGenerator(title);

  const imageBuffer = await imageResponse.arrayBuffer();
  const imagePath = path.join(process.cwd(), 'public', 'og-images', `${slug}.png`);
  await fs.mkdir(path.dirname(imagePath), { recursive: true });
  await fs.writeFile(imagePath, Buffer.from(imageBuffer));

  return `/og-images/${slug}.png`;
}

const imagePath = await generateAndSaveImage(title, slug);
---

<img src={imagePath} alt={title} width="1200" height="630" />
