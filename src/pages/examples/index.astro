---
import Layout from '../../layouts/Layout.astro';
import { recipients } from '../../lib/apologyData';
import { getCollection } from 'astro:content';

const allLetters = await getCollection('letters');

// Contar las cartas para cada destinatario
const letterCounts = allLetters.reduce((acc, letter) => {
  const recipient = letter.id.split('/')[0];
  acc[recipient] = (acc[recipient] || 0) + 1;
  return acc;
}, {} as Record<string, number>);

// Filtrar solo los destinatarios con cartas existentes
const recipientsWithLetters = recipients.filter(recipient => letterCounts[recipient.value] > 0);
---

<Layout title="Apology Letter Examples" description="Browse example apology letters for various recipients">
  <main class="container mx-auto px-4 py-8">
    <h1 class="text-4xl font-bold mb-8 text-center">Apology Letter Examples</h1>
    
    {recipientsWithLetters.length === 0 ? (
      <p class="text-center text-gray-600">No example letters available yet.</p>
    ) : (
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        {recipientsWithLetters.map((recipient) => (
          <a href={`/examples/${recipient.value}`} class="card bg-base-100 shadow-xl hover:shadow-2xl transition-shadow">
            <div class="card-body">
              <h2 class="card-title">{recipient.label}</h2>
              <p>
                {letterCounts[recipient.value]} example{letterCounts[recipient.value] !== 1 ? 's' : ''}
              </p>
            </div>
          </a>
        ))}
      </div>
    )}
  </main>
</Layout>
